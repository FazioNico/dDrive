<div class="wrapper ion-padding">

  <ion-grid>
    <ion-row>
      <ion-col>
        <h1>
          <span>Encryption</span>
        </h1>
      </ion-col>
    </ion-row>
    <ion-row *ngIf="isDisplayConditionForm === false">
      <ion-col>
        <p>
          Do you want to encrypt your data using Lit network protocol? <br/>
          This will allow you to define custom controls access condition to your data to prevent unauthorized access.
        </p>
        <div class="ion-text-end">
          <ion-button fill="outline" (click)="modalCtrl.dismiss([], 'cancel')">
            No
          </ion-button>
          <ion-button (click)="isDisplayConditionForm = true">
            Yes
          </ion-button>
        </div>
      </ion-col>
    </ion-row>
    <ion-row *ngIf="isDisplayConditionForm === true">
      <ion-col *ngIf="form">
        <p>
          Define access conditions to your data.
        </p>
        <!-- Chain Id -->
        <ion-item color="light">
          <ion-label>Blockchain</ion-label>
          <ion-select [value]="chainId" disabled>
            <ion-select-option [value]="chainId">
              {{chainId|networkName}}
            </ion-select-option>
          </ion-select>
        </ion-item>
        <form [formGroup]="form" class="ion-padding-bottom">
          <ion-accordion-group
            [multiple]="true"
            [value]="['walletAddress']">
            <!-- By wallets address owner -->
            <ion-accordion 
                value="walletAddress" 
                toggleIcon="" 
                toggleIconSlot="end"
                formGroupName="walletAddress">
              <ion-item 
                  slot="header" 
                  color="light"
                  (click)="toggleCondition('walletAddress')">
                <ion-label>Access by wallet address</ion-label>
                <ion-icon slot="end" [name]="form.get('walletAddress')?.get('selected')?.value === true ? 'checkbox': 'square-outline'"></ion-icon>
              </ion-item>
              <div class="ion-padding-vertical" slot="content">
                <ion-chip 
                  color="primary"
                  *ngFor="let el of form.get('walletAddress')?.get('values')?.value; let i = index">
                  {{ el | sliceAddress}} 
                  <small *ngIf="el === walletAddress" class="ion-margin-start">(me)</small>
                  <ion-icon *ngIf="el !== walletAddress" name="close-circle" (click)="removeValue('walletAddress.values', i)"></ion-icon>
                </ion-chip>
                <br/>
                <ion-item>
                  <ion-input #inputWalletAddress placeholder="new wallet address"></ion-input>
                  <ion-button size="small" fill="outline" slot="end" (click)="addValue('walletAddress.values', inputWalletAddress.value + ''); inputWalletAddress.value = ''">add</ion-button>
                </ion-item>
              </div>
            </ion-accordion>
            <!-- By NFT contract holders -->
            <ion-accordion 
                value="nftOwner" 
                toggleIcon="" 
                toggleIconSlot="end"
                formGroupName="nftOwner">
              <ion-item 
                  slot="header" 
                  color="light"
                  (click)="toggleCondition('nftOwner')">
                <ion-label>Must posess any token in an ERC721 collection (NFT Collection)</ion-label>
                <ion-icon slot="end" [name]="form.get('nftOwner')?.get('selected')?.value === true ? 'checkbox': 'square-outline'"></ion-icon>
              </ion-item>
              <div slot="content" class="">
                <ion-item formArrayName="values">
                  <ion-label position="stacked">Collection contract address</ion-label>
                  <ion-input formControlName="0" type="text"></ion-input>
                </ion-item>
              </div>
            </ion-accordion>
            <!-- By DAO members -->
            <ion-accordion 
                disabled="true"
                value="daoMember" 
                toggleIcon="" 
                toggleIconSlot="end"
                formGroupName="daoMember">
              <ion-item 
                  slot="header" 
                  color="light"
                  (click)="toggleCondition('daoMember')">
                <ion-label>Must be a member of a DAO</ion-label>
                <ion-icon slot="end" [name]="form.get('daoMember')?.get('selected')?.value === true ? 'checkbox': 'square-outline'"></ion-icon>
              </ion-item>
              <div slot="content" class="">
                <ion-item formArrayName="values">
                  <ion-label position="stacked">DAO contract address</ion-label>
                  <ion-input formControlName="0" type="text"></ion-input>
                </ion-item>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </form>
        <ion-item class="ion-margin-top" color="warning">
          <ion-icon slot="start" name="warning"></ion-icon>
          <ion-label class="ion-text-wrap">
            <span>
              By enabling encryption, you will not be able to access your data without the correct access conditions. <br/>
              Check again Contract Address and Wallet Address before validate encryption access conditions rules.
            </span>
          </ion-label>
        </ion-item>
      </ion-col>
      <ion-col size="12" class="ion-padding-top ion-text-end">
        <ion-button fill="outline" (click)="modalCtrl.dismiss(null, 'cancel')">
          Cancel
        </ion-button>
        <ion-button (click)="submit()">
          Save
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>